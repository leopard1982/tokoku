{% extends 'initial.html'%}
{% load humanize %}

{% block title %}
L-tokoku | Master Pelanggan
{% endblock %}

{% block header_sidebar%}
    Master Data
{% endblock%}

{% block sidebar%}
<button type="button" class="btn form-control btn-outline-success mt-2 mb-2 p-2" id="viewmasterbarang">Daftar Barang</button>
<button type="button" class="btn form-control btn-outline-success mt-2 mb-2 p-2" id="viewmastersupplier">Daftar Supplier</button>
<button type="button" class="btn form-control btn-outline-success mt-2 mb-2 p-2" id="viewmasterpelanggan">Daftar Pelanggan</button>
{% endblock%}

{% block stamp%}
Daftar Pelanggan
{% endblock%}

{% block konfirmasi%}
<div style="display: none;" id="konfirmasinya" class="container-fluid d-flex justify-content-center">
        
    <div class="card border-info w-50 text-center shadow justify-content-center" style="display: none; background: linear-gradient(to bottom,skyblue,whitesmoke);" id="konfirmasinya2">
        <div class=" d-flex justify-content-center rounded">
            <div class="col-11 bg-info p-2 card-text">
                Konfirmasi
            </div>
            <div class="col-1 d-flex justify-content-start rounded  bg-info">
                <button class="btn btn-info"  onclick="batalkan()">X</button>
            </div>
 
        </div>
        Apakah benar akan dilakukan penghapusan untuk pelanggan dengan kode pelanggan: <span id="kode_pelanggan" style="font-weight: bold;"></span> dengan nama pelanggan: <span id="nama_pelanggan" style="font-weight: bold;"></span>?
        <div class="d-flex justify-content-center container">
            <button  id="hapuskanlah"  class="btn btn-danger" onclick="hapuskan()">Ya! Data Barang Dihapus! </button>
        </div>
        <br>            
    </div> 
</div>
{% endblock%}

{% block content%}
    <table class="table">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Id</th>
                <th scope="col">Nama</th>
                <th scope="col">Tlp.</th>
                <th scope="col">Alamat</th>
                <th scope="col">KTP</th>
                <th scope="col">Tipe</th>
                <th scope="col">Hapus</th>
            </tr>
        </thead>
        {% for dataku in data %}
        <tr class="{% cycle 'table-primary' 'table-secondary' 'table-success'%}"  style="overflow-x: auto;">
            <th scope="col">{{forloop.counter}}</th>
            <td>{{dataku.kode_pelanggan}}</td>
            <td>{{dataku.nama_pelanggan}}</td>
            <td>{{dataku.nomor_tlp}}</td>
            <td>{{dataku.alamat_pelanggan}}</td>
            <td>
                {% if dataku.foto_ktp == ""%}
                ---*---
                {% else %}
                <img style="width: 100px; height: 50px" src="{{dataku.foto_ktp.url}}">
                {% endif%}
            </td>
            <td>{{dataku.get_tipe_display}}</td>
            <td>{% if dataku.hapus%}
                {% if not dataku.kode_pelanggan == "Eceran" %}
                    <button onclick="konfirmasi_hapus('{{dataku.kode_pelanggan}}^{{dataku.nama_pelanggan}}')" class="btn btn-outline-danger">Hapus</button>
                {% else%}
                    ***-***
                {% endif %}
            {% else %}
                <button disabled class="btn btn-outline-dark">Hapus</button>
            {% endif%}
        </td>
        </tr>
        {% endfor %}
        <tr>
            <td colspan="8">Jumlah Pelanggan: {{jml_data}} orang</td>
        </tr>
    </table>
{% endblock%}

{% block javascript%}
<script>
    function konfirmasi_hapus(data) {
        $('#konfirmasinya').css('position', 'absolute');
        $('#konfirmasinya').addClass('py-5');
        $('#konfirmasinya').show(1000);
        $('#konfirmasinya2').show(1000);
        document.getElementById('kode_pelanggan').innerHTML = data.split('^')[0];
        document.getElementById('nama_pelanggan').innerHTML = data.split('^')[1];
        document.getElementById('hapuskanlah').value = data.split('^')[0];
    };
    function batalkan() {
      $('#konfirmasinya').hide(1000);
      $('#konfirmasinya2').hide(1000);      
    };

    function hapuskan() {
      window.location.href= '/d/mp/' + document.getElementById('hapuskanlah').value;
    }
</script>
{% endblock%}
